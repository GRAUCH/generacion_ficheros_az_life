plugins {
    id 'java'
    id 'application'
}

group = 'com.scortelemed.azlife'
version = '1.0.0'

java {
    // Fuerza compilaciÃ³n con Java 8
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}

repositories {
    mavenCentral()
}

dependencies {
    // Incluye cualquier jar en lib/
    implementation fileTree(dir: 'lib', include: ['*.jar'])
}

application {
    // Clase principal del programa
    mainClass = 'com.scortelemed.azlife.GenerarFicheros'
}

// ðŸ”¹ Asegura que Gradle compile las clases desde /src
sourceSets {
    main {
        java {
            srcDirs = ['src']
        }
        resources {
            srcDirs = ['resources']
        }
    }
}

// ðŸ”¹ Configura la tarea de compilaciÃ³n
tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}

// ðŸ”¹ Limpieza personalizada
tasks.clean {
    delete "build"
}

// ðŸ”¹ Configura el JAR ejecutable
tasks.jar {
    archiveBaseName.set("GeneracionFicherosAzLife")
    archiveVersion.set("")
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE

    manifest {
        attributes(
                "Main-Class": application.mainClass.get()
        )
    }

    // Incluye clases compiladas
    from sourceSets.main.output

    // ðŸ”¹ Incluye todas las dependencias de runtime
    from {
        configurations.runtimeClasspath.collect {
            it.isDirectory() ? it : zipTree(it)
        }
    }

    // ðŸ”¹ Incluye JARs externos de lib/ explÃ­citamente
    from {
        fileTree(dir: 'lib', include: ['*.jar']).collect { zipTree(it) }
    }
    // ðŸ‘‰ fuerza que tu log4j.properties quede al final
    from('resources') {
        include 'log4j.properties'
        into ''
    }
}

